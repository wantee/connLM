/*
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Wang Jian
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

#include <stdio.h>

#include "param.h"

#define M 23
#define N 17

//#define PRINT printf
#define PRINT(...)

static int unit_test_param_acc_wt()
{
    real_t wt[N*M];
    real_t in[M];
    real_t er[N];
    real_t delta_wt[N*M];

    real_t ref[5][N*M] = {
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 44, 42, 40, 38, 36, 34, 32, 30, 28, 26, 24, 22, 20, 18, 16, 14, 12, 10, 8, 6, 4, 2, 0, 66, 63, 60, 57, 54, 51, 48, 45, 42, 39, 36, 33, 30, 27, 24, 21, 18, 15, 12, 9, 6, 3, 0, 88, 84, 80, 76, 72, 68, 64, 60, 56, 52, 48, 44, 40, 36, 32, 28, 24, 20, 16, 12, 8, 4, 0, 110, 105, 100, 95, 90, 85, 80, 75, 70, 65, 60, 55, 50, 45, 40, 35, 30, 25, 20, 15, 10, 5, 0, 132, 126, 120, 114, 108, 102, 96, 90, 84, 78, 72, 66, 60, 54, 48, 42, 36, 30, 24, 18, 12, 6, 0, 154, 147, 140, 133, 126, 119, 112, 105, 98, 91, 84, 77, 70, 63, 56, 49, 42, 35, 28, 21, 14, 7, 0, 176, 168, 160, 152, 144, 136, 128, 120, 112, 104, 96, 88, 80, 72, 64, 56, 48, 40, 32, 24, 16, 8, 0, 198, 189, 180, 171, 162, 153, 144, 135, 126, 117, 108, 99, 90, 81, 72, 63, 54, 45, 36, 27, 18, 9, 0, 220, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 110, 100, 90, 80, 70, 60, 50, 40, 30, 20, 10, 0, 242, 231, 220, 209, 198, 187, 176, 165, 154, 143, 132, 121, 110, 99, 88, 77, 66, 55, 44, 33, 22, 11, 0, 264, 252, 240, 228, 216, 204, 192, 180, 168, 156, 144, 132, 120, 108, 96, 84, 72, 60, 48, 36, 24, 12, 0, 286, 273, 260, 247, 234, 221, 208, 195, 182, 169, 156, 143, 130, 117, 104, 91, 78, 65, 52, 39, 26, 13, 0, 308, 294, 280, 266, 252, 238, 224, 210, 196, 182, 168, 154, 140, 126, 112, 98, 84, 70, 56, 42, 28, 14, 0, 330, 315, 300, 285, 270, 255, 240, 225, 210, 195, 180, 165, 150, 135, 120, 105, 90, 75, 60, 45, 30, 15, 0, 352, 336, 320, 304, 288, 272, 256, 240, 224, 208, 192, 176, 160, 144, 128, 112, 96, 80, 64, 48, 32, 16, 0, },
{0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 22, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 44, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 66, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 88, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 110, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 132, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 154, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 176, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 198, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 220, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 242, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 264, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 286, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 308, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 330, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 352, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, },
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, },
{-9, 13, -9, 17, -9, 21, -9, 25, -9, 29, -9, 33, -9, 37, -9, 41, -9, 45, -9, 49, -9, 53, -9, 57, -9, 61, -9, 65, -9, 69, -9, 73, -9, 77, -9, 81, -9, 85, -9, 89, -9, 93, -9, 97, -9, 101, -9, 105, -9, 109, -9, 113, -9, 117, -9, 121, -9, 125, -9, 129, -9, 133, -9, 137, -9, 141, -9, 145, -9, 149, -9, 153, -9, 157, -9, 161, -9, 165, -9, 169, -9, 173, -9, 177, -9, 181, -9, 185, -9, 189, -9, 193, -9, 197, -9, 201, -9, 205, -9, 209, -9, 213, -9, 217, -9, 221, -9, 225, -9, 229, -9, 233, -9, 237, -9, 241, -9, 245, -9, 249, -9, 253, -9, 257, -9, 261, -9, 265, -9, 269, -9, 273, -9, 277, -9, 281, -9, 285, -9, 289, -9, 293, -9, 297, -9, 301, -9, 305, -9, 309, -9, 313, -9, 317, -9, 321, -9, 325, -9, 329, -9, 333, -9, 337, -9, 341, -9, 345, -9, 349, -9, 353, -9, 357, -9, 361, -9, 365, -9, 369, -9, 373, -9, 377, -9, 381, -9, 385, -9, 389, -9, 393, -9, 397, -9, 401, -9, 405, -9, 409, -9, 413, -9, 417, -9, 421, -9, 425, -9, 429, -9, 433, -9, 437, -9, 441, -9, 445, -9, 449, -9, 453, -9, 457, -9, 461, -9, 465, -9, 469, -9, 473, -9, 477, -9, 481, -9, 485, -9, 489, -9, 493, -9, 497, -9, 501, -9, 505, -9, 509, -9, 513, -9, 517, -9, 521, -9, 525, -9, 529, -9, 533, -9, 537, -9, 541, -9, 545, -9, 549, -9, 553, -9, 557, -9, 561, -9, 565, -9, 569, -9, 573, -9, 577, -9, 581, -9, 585, -9, 589, -9, 593, -9, 597, -9, 601, -9, 605, -9, 609, -9, 613, -9, 617, -9, 621, -9, 625, -9, 629, -9, 633, -9, 637, -9, 641, -9, 645, -9, 649, -9, 653, -9, 657, -9, 661, -9, 665, -9, 669, -9, 673, -9, 677, -9, 681, -9, 685, -9, 689, -9, 693, -9, 697, -9, 701, -9, 705, -9, 709, -9, 713, -9, 717, -9, 721, -9, 725, -9, 729, -9, 733, -9, 737, -9, 741, -9, 745, -9, 749, -9, 753, -9, 757, -9, 761, -9, 765, -9, 769, -9, 773, -9, 777, -9, 781, -9, 785, -9, 789, -9, },
{-9, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 57, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, -9, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 149, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, -9, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 241, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, -9, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 333, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, -9, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 425, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, -9, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 517, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, -9, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 609, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, -9, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 701, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, -9, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, },
    };

    int ncase = -1;
    int i;

    fprintf(stderr, " Testing param_acc_wt...\n");

    for (i = 0; i < M; i++) {
        in[i] = (i + 1);
    }

    for (i = 0; i < N; i++) {
        er[i] = -(i + 1);
    }

    for (i = 0; i < N*M; i++) {
        delta_wt[i] = ((i & 0x01) ? 1.0 : -1.0) * (i + 10);
    }

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_acc_wt(wt, er, N, in, M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_acc_wt(wt, er, N, NULL, M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_acc_wt(wt, er, N, NULL, -1);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_acc_wt(wt, delta_wt, -N, in, M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_acc_wt(wt, delta_wt, -N, NULL, -M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    return 0;
}

static int unit_test_param_update()
{
    param_t param;
    param_arg_t param_arg;

    real_t wt[N*M];
    real_t in[M];
    real_t er[N];
    real_t delta_wt[N*M];

    real_t ref[5][N*M] = {
{-2, -4, -6, -8, -10, -12, -14, -16, -18, -20, -22, -24, -26, -28, -30, -32, -34, -36, -38, -40, -42, -44, -46, -26, -29, -32, -35, -38, -41, -44, -47, -50, -53, -56, -59, -62, -65, -68, -71, -74, -77, -80, -83, -86, -89, -92, -50, -54, -58, -62, -66, -70, -74, -78, -82, -86, -90, -94, -98, -102, -106, -110, -114, -118, -122, -126, -130, -134, -138, -74, -79, -84, -89, -94, -99, -104, -109, -114, -119, -124, -129, -134, -139, -144, -149, -154, -159, -164, -169, -174, -179, -184, -98, -104, -110, -116, -122, -128, -134, -140, -146, -152, -158, -164, -170, -176, -182, -188, -194, -200, -206, -212, -218, -224, -230, -122, -129, -136, -143, -150, -157, -164, -171, -178, -185, -192, -199, -206, -213, -220, -227, -234, -241, -248, -255, -262, -269, -276, -146, -154, -162, -170, -178, -186, -194, -202, -210, -218, -226, -234, -242, -250, -258, -266, -274, -282, -290, -298, -306, -314, -322, -170, -179, -188, -197, -206, -215, -224, -233, -242, -251, -260, -269, -278, -287, -296, -305, -314, -323, -332, -341, -350, -359, -368, -194, -204, -214, -224, -234, -244, -254, -264, -274, -284, -294, -304, -314, -324, -334, -344, -354, -364, -374, -384, -394, -404, -414, -218, -229, -240, -251, -262, -273, -284, -295, -306, -317, -328, -339, -350, -361, -372, -383, -394, -405, -416, -427, -438, -449, -460, -242, -254, -266, -278, -290, -302, -314, -326, -338, -350, -362, -374, -386, -398, -410, -422, -434, -446, -458, -470, -482, -494, -506, -266, -279, -292, -305, -318, -331, -344, -357, -370, -383, -396, -409, -422, -435, -448, -461, -474, -487, -500, -513, -526, -539, -552, -290, -304, -318, -332, -346, -360, -374, -388, -402, -416, -430, -444, -458, -472, -486, -500, -514, -528, -542, -556, -570, -584, -598, -314, -329, -344, -359, -374, -389, -404, -419, -434, -449, -464, -479, -494, -509, -524, -539, -554, -569, -584, -599, -614, -629, -644, -338, -354, -370, -386, -402, -418, -434, -450, -466, -482, -498, -514, -530, -546, -562, -578, -594, -610, -626, -642, -658, -674, -690, -362, -379, -396, -413, -430, -447, -464, -481, -498, -515, -532, -549, -566, -583, -600, -617, -634, -651, -668, -685, -702, -719, -736, -386, -404, -422, -440, -458, -476, -494, -512, -530, -548, -566, -584, -602, -620, -638, -656, -674, -692, -710, -728, -746, -764, -782, },
{-3, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, -28, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, -53, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, -78, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, -103, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, -128, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, -153, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, -178, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, -203, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, -228, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, -253, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, -278, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, -303, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, -328, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, -353, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, -378, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, -403, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, },
{-2, -4, -6, -8, -10, -12, -14, -16, -18, -20, -22, -24, -26, -28, -30, -32, -34, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, },
{-31, 31, -39, 35, -47, 39, -55, 43, -63, 47, -71, 51, -79, 55, -87, 59, -95, 63, -103, 67, -111, 71, -119, 75, -127, 79, -135, 83, -143, 87, -151, 91, -159, 95, -167, 99, -175, 103, -183, 107, -191, 111, -199, 115, -207, 119, -215, 123, -223, 127, -231, 131, -239, 135, -247, 139, -255, 143, -263, 147, -271, 151, -279, 155, -287, 159, -295, 163, -303, 167, -311, 171, -319, 175, -327, 179, -335, 183, -343, 187, -351, 191, -359, 195, -367, 199, -375, 203, -383, 207, -391, 211, -399, 215, -407, 219, -415, 223, -423, 227, -431, 231, -439, 235, -447, 239, -455, 243, -463, 247, -471, 251, -479, 255, -487, 259, -495, 263, -503, 267, -511, 271, -519, 275, -527, 279, -535, 283, -543, 287, -551, 291, -559, 295, -567, 299, -575, 303, -583, 307, -591, 311, -599, 315, -607, 319, -615, 323, -623, 327, -631, 331, -639, 335, -647, 339, -655, 343, -663, 347, -671, 351, -679, 355, -687, 359, -695, 363, -703, 367, -711, 371, -719, 375, -727, 379, -735, 383, -743, 387, -751, 391, -759, 395, -767, 399, -775, 403, -783, 407, -791, 411, -799, 415, -807, 419, -815, 423, -823, 427, -831, 431, -839, 435, -847, 439, -855, 443, -863, 447, -871, 451, -879, 455, -887, 459, -895, 463, -903, 467, -911, 471, -919, 475, -927, 479, -935, 483, -943, 487, -951, 491, -959, 495, -967, 499, -975, 503, -983, 507, -991, 511, -999, 515, -1007, 519, -1015, 523, -1023, 527, -1031, 531, -1039, 535, -1047, 539, -1055, 543, -1063, 547, -1071, 551, -1079, 555, -1087, 559, -1095, 563, -1103, 567, -1111, 571, -1119, 575, -1127, 579, -1135, 583, -1143, 587, -1151, 591, -1159, 595, -1167, 599, -1175, 603, -1183, 607, -1191, 611, -1199, 615, -1207, 619, -1215, 623, -1223, 627, -1231, 631, -1239, 635, -1247, 639, -1255, 643, -1263, 647, -1271, 651, -1279, 655, -1287, 659, -1295, 663, -1303, 667, -1311, 671, -1319, 675, -1327, 679, -1335, 683, -1343, 687, -1351, 691, -1359, 695, -1367, 699, -1375, 703, -1383, 707, -1391, 711, -1399, 715, -1407, 719, -1415, 723, -1423, 727, -1431, 731, -1439, 735, -1447, 739, -1455, 743, -1463, 747, -1471, 751, -1479, 755, -1487, 759, -1495, 763, -1503, 767, -1511, 771, -1519, 775, -1527, 779, -1535, 783, -1543, 787, -1551, 791, -1559, 795, -1567, 799, -1575, 803, -1583, 807, -1591, },
{-11, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 9, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, -103, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 9, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, -195, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 9, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, -287, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 9, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, -379, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 9, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, -471, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 9, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, -563, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 9, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, -655, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 9, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, -747, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, },
    };

    int ncase = -1;
    int i;

    fprintf(stderr, " Testing param_update...\n");

    for (i = 0; i < M; i++) {
        in[i] = (i + 1);
    }

    for (i = 0; i < N; i++) {
        er[i] = -(i + 1);
    }

    for (i = 0; i < N*M; i++) {
        delta_wt[i] = ((i & 0x01) ? 1.0 : -1.0) * (i + 10);
    }

    param.learn_rate = 1.0;
    param.l1_penalty = 2.0;
    param.l2_penalty = 2.0;
    param.l2_gap = 1;
    param.momentum = 1.0;
    param.mini_batch = 0;

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_arg_clear(&param_arg);
    param_update(&param, &param_arg, true, wt, er, 1.0, N, in, M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_arg_clear(&param_arg);
    param_update(&param, &param_arg, true, wt, er, 2.0, N, NULL, M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_arg_clear(&param_arg);
    param_update(&param, &param_arg, true, wt, er, 1.0, N, NULL, -1);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_arg_clear(&param_arg);
    param_update(&param, &param_arg, true, wt, delta_wt, 3.0, -N, in, M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    fprintf(stderr, "   Case: %d...", ++ncase);
    for (i = 0; i < N*M; i++) {
        wt[i] = (i + 1);
    }
    param_arg_clear(&param_arg);
    param_update(&param, &param_arg, true, wt, delta_wt, 1.0, -N, NULL, -M);
    PRINT("{");
    for (i = 0; i < N*M; i++) {
        PRINT("%g, ", wt[i]);
        if (wt[i] != ref[ncase][i]) {
            PRINT("F(%d/%g)\n", i, wt[i]);
            fprintf(stderr, "Failed\n");
            return -1;
        }
    }
    PRINT("},\n");
    fprintf(stderr, "Passed\n");

    return 0;
}

static int run_all_tests()
{
    int ret = 0;

    if (unit_test_param_acc_wt() != 0) {
        ret = -1;
    }

    if (unit_test_param_update() != 0) {
        ret = -1;
    }

    return ret;
}

int main(int argc, const char *argv[])
{
    int ret;

    fprintf(stderr, "Start testing...\n");
    ret = run_all_tests();
    if (ret != 0) {
        fprintf(stderr, "Tests failed.\n");
    } else {
        fprintf(stderr, "Tests succeeded.\n");
    }

    return ret;
}

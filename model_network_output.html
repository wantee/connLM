<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>connLM: The Output Layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="connlm.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="connLMTextAndLogo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">connLM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('model_network_output.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The Output Layer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="model_network_output_intro"></a>
Introduction</h1>
<p>A connLM model can only contain one output layer, which is shared by one or more component models.</p>
<p>An output layer must be generated before other components added.</p>
<p>The related source code is in <a class="el" href="output_8h_source.html">output.h</a>. <a class="el" href="group__g__output.html#ga91742671d4d03a5a6a29417c4e4d1456" title="Generate output tree with word counts. ">output_generate()</a> can be called to generate a output layer with specific options.</p>
<p>The command line interface for generating output layer is <a class="el" href="cmd.html#cmd_output">connlm-output</a>.</p>
<h1><a class="anchor" id="model_network_output_process"></a>
The Building Process</h1>
<p>Output layer is a tree whose structure is based on counts of words in vocabulary. The main goal is to make the frequent words with less computations during the softmax summation, and the rare words with more computations. Thus, the total computational complexity could be lower.</p>
<p>The <a class="el" href="structoutput__opt__t.html" title="Parameters for output tree. ">output_opt_t</a> can be used to control the building process of tree:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_output_opt_t_ {</div><div class="line">    <a class="code" href="group__g__output.html#ga650276dff821cd16b390a89c12e57fde">output_method_t</a> method; </div><div class="line">    <span class="keywordtype">int</span> max_depth; </div><div class="line">    <span class="keywordtype">int</span> max_branch; </div><div class="line">} <a class="code" href="structoutput__opt__t.html">output_opt_t</a>;</div></div><!-- fragment --><p><code>method</code> specifies which method to be applied to build the tree. <code>max_depth</code> controls the maximum depth of tree, while <code>max_branch</code> determines maximum number of branches for every internal node in the tree.</p>
<p>There are two methods to build the tree, the Top-Down and the Bottom-Up. They are different for the direction of tree building. Both will result a tree with all words on leaf nodes.</p>
<p>For the Top-Down method, we first put all words in the root node of tree. Then, the words within a node is split to <code>max_branch</code> subset, with the total counts of every subset is roughly equal with each other. The subsets are then became a node and added to the tree. The splitting process keeps running until every leaf node of the tree contains only one word, or the <code>max_depth</code> is met.</p>
<p>For the Bottom-Up method, in contrast, we will perform a merging process similar with the algorithm to build a Huffman tree. All words, initially, are placed on a leaf node of the tree. Then, we select the <code>max_branch</code> nodes with largest count, and merge them as a new node. At last, they will be merged to a single root node, or when we reach the <code>max_depth</code>, we stop the merging and place a root node to connect all remaining nodes.</p>
<p>Following are example of trees built by both methods from a small vocabulary.</p>
<p><div class="dotgraph">
<img src="dot_output_topdown.png" alt="dot_output_topdown.png" border="0" usemap="#dot_output_topdown.map"/>
<map name="dot_output_topdown.map" id="dot_output_topdown.map"></map>
<div class="caption">
Simple output tree built from top-down</div>
</div>
 <div class="dotgraph">
<img src="dot_output_bottomup.png" alt="dot_output_bottomup.png" border="0" usemap="#dot_output_bottomup.map"/>
<map name="dot_output_bottomup.map" id="dot_output_bottomup.map"></map>
<div class="caption">
Simple output tree built from bottom-up</div>
</div>
 </p>
<h1><a class="anchor" id="model_network_output_norm"></a>
The Normalization Method</h1>
<p>Besides the structure, the other property for output layer is the normalization method. This could be specified in the topology file together with configuration of <a class="el" href="model_network_comp.html#model_network_comp_topo">other components</a>. The normalization is performed on all children for every internal node.</p>
<p>The format for output normalization method in topology file is:</p>
<div class="fragment"><div class="line">&lt;output&gt;</div><div class="line">  <span class="keyword">property</span> norm=softmax</div><div class="line">&lt;/output&gt;</div></div><!-- fragment --><p>Currently, connLM only support the Softmax normalization. We may include some sampling based normalization, e.g., NCE.</p>
<p>Since there would be more nodes in tree than words, in order to save space and computation, we do not implement the softmax in the usual way. Recall that the formula for softmax is</p>
<p class="formulaDsp">
\[ \Pr(Y = i) = \frac{e^{x_i}}{\sum_{k=1}^{K}{e^{x_k}}} \]
</p>
<p>However, we also can see it as multinomial logit, by fixing the score of Kth class to 1, i.e.,</p>
<p class="formulaDsp">
\[ \begin{aligned} \Pr(Y = K) &amp;= \frac{1}{1+\sum_{k=1}^{K-1}{e^{x_k}}} \\ \Pr(Y = i) &amp;= \frac{e^{x_i}}{1+\sum_{k=1}^{K-1}{e^{x_k}}}, \forall i &lt; K \end{aligned} \]
</p>
<p>In this way, for every internal nodes in the tree, we can save one vector for both storage and computation. For a perfect binary tree with N leafs, there will be (N - 1) non-leaf nodes. With the regular softmax, we will need (2N - 2) vectors as weight, however, by applying the multi-logit, the demand can be reduced by (N - 1), which is the half of the original. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">connLM</a></li><li class="navelem"><a class="el" href="model.html">The connLM Model</a></li><li class="navelem"><a class="el" href="model_network.html">The Network</a></li>
    <li class="footer">Generated on Tue May 9 2017 14:46:15 for connLM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>

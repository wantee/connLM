<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>connLM: The Example Recipes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="connlm.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="connLMTextAndLogo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">connLM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('examples.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The Example Recipes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We have several example recipes for different corpora, which are all under <code>egs/</code>.</p>
<p>We have done some tuning for the hyper-parameters, and report the final PPLs. Users can use these examples as the starting point for their own project.</p>
<p>Currently, examples included with connLM are:</p><ul>
<li><a href="https://catalog.ldc.upenn.edu/ldc97s62">Switchboard 1 (SWBD1)</a>, downloaded from <a href="http://www.openslr.org/resources/5/switchboard_word_alignments.tar.gz">openslr.org</a>.</li>
<li><a href="http://www.cis.upenn.edu/~treebank/">Penn Tree Bank (PTB)</a>, downloaded from <a href="http://www.fit.vutbr.cz/~imikolov/rnnlm/simple-examples.tgz">Tomas Mikolov's webpage</a>.</li>
<li><a href="http://www-lium.univ-lemans.fr/en/content/ted-lium-corpus">Tedlium</a>, downloaded from <a href="http://www.openslr.org/resources/19/TEDLIUM_release2.tar.gz">openslr.org</a>.</li>
<li><a href="http://www.danielpovey.com/files/2015_icassp_librispeech.pdf">LibriSpeech</a>, downloaded from <a href="http://www.openslr.org/12/">openslr.org</a>.</li>
<li><a href="http://www.statmt.org/lm-benchmark/">1 Billion Word Language Model Benchmark</a>, downloaded from <a href="http://statmt.org/wmt11/training-monolingual.tgz">statmt.org</a>.</li>
</ul>
<p>Scripts for each example is placed under a sub-directory named with the corpus.</p>
<p>There are some standard scripts wrapping the command line tools under <code>egs/steps/</code>, including:</p><ul>
<li><code>learn_vocab.sh</code>, which generates a vocabulary from a text source.</li>
<li><code>init_model.sh</code>, which initializes a connLM model, with specified structure.</li>
<li><code>train_model.sh</code>, which trains a model with training corpus.</li>
<li><code>eval_model.sh</code>, which evaluate a (trained) model on some test set.</li>
</ul>
<p>and,</p>
<ul>
<li><code>run_standalone.sh</code>, which wraps the above scripts to train a model, whose topology is fixed at the beginning of training.</li>
<li><code>run_cascade.sh</code>, which trains a model as <code>run_standalone.sh</code>, but the topology of model could be extended during training.</li>
</ul>
<p>Other common utility scripts are under <code>egs/utils/</code>.</p>
<h1><a class="anchor" id="examples_tiny"></a>
Recipe Internal</h1>
<p>There is a tiny example for demonstration and regression testing, which can be found in <code>egs/tiny</code>. From this, you can see the how training works in connLM.</p>
<h2><a class="anchor" id="examples_dir_struct"></a>
Directory Structure</h2>
<p>For every example, we will have a <code>run.sh</code> placed in the root of example directory, served as the main user interface for training.</p>
<p>Besides, there usually are following sub-directories:</p><ul>
<li><code>conf/</code>, which stores the configurations for all models, different models may have their own sub-directory.</li>
<li><code>local/</code>, which contains the custom scripts only used by this example, such as the downloading and pre-processing related scripts.</li>
<li><code>data/</code>, which contains the pre-processed data files, using directly by the connLM command line tools. This could be created after the prep-data step in some examples.</li>
<li><code>exp/</code>, which is the working directory for training.</li>
</ul>
<h2><a class="anchor" id="examples_step"></a>
Running Steps</h2>
<p>The main shell script for training is <code>run.sh</code>. <code>run.sh</code> accepts a <code>-h</code> option to print helping message,</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./run.sh -h</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;usage: ./run.sh [steps]</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;e.g.: ./run.sh -3,5,7-9,10-</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  stpes could be a number range within 1-7:</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   step1:   Learn Vocab</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   step2:   Train MaxEnt model</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   step3:   Train CBOW model</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   step4:   Train FFNN model</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;   step5:   Train RNN model</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;   step6:   Train RNN+MaxEnt model</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;   step7:   Train RNN~MaxEnt merge model</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;options:</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;     --conf-dir &lt;conf-dir&gt;         # config directory.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;     --exp-dir &lt;exp-dir&gt;           # exp directory.</div></div><!-- fragment --><p><code>run.sh</code> has one positional arguments, which specify the steps user would like to run. Steps could be one or more integers with comma and dash, default value is empty, which means run all steps. The job of parsing these strings is done by <a href="https://github.com/wantee/shutils">shutils</a> library.</p>
<p>The steps is defined at the beginning of <code>run.sh:</code> </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;stepnames[1]=&quot;Learn Vocab&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;stepnames+=(&quot;Train MaxEnt model:maxent&quot;)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;stepnames+=(&quot;Train CBOW model:cbow&quot;)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;stepnames+=(&quot;Train FFNN model:ffnn&quot;)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;stepnames+=(&quot;Train RNN model:rnn&quot;)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;stepnames+=(&quot;Train RNN+MaxEnt model:rnn+maxent&quot;)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;stepnames+=(&quot;Train RNN~MaxEnt merge model:rnn~maxent&quot;)</div></div><!-- fragment --><p>The step names consists of two parts, the left part of colon defines the display name of this step and the right part gives the corresponding sub-directory name under <code>conf-dir</code>, where <code>run.sh</code> can find the configurations for training. Generally, a word in step name is a single component of the model. A '+' means the two components are merged in one model, but a '~' represents the cascaded model, i.e., we will extend the components of the model one by one.</p>
<h2><a class="anchor" id="examples_prep"></a>
Preparing Data</h2>
<p>For most of the corpora, we need to pre-process the raw data, and convert them into format accepted by connLM toolkit.</p>
<p>The scripts for preprocessing should be placed in <code>local/</code> as they normally are only relevant with one corpus.</p>
<p>After processing, there should be three files in <code>data/</code> directory, i.e., <code>data/train</code>, <code>data/valid</code> and <code>data/test</code> for training, validating and testing respectively.</p>
<h2><a class="anchor" id="examples_vocab"></a>
Learning the Vocabulary</h2>
<p>Before training the model, we need to generate the vocabulary first. Vocabulary is a mapping which maps word strings into integer ids, see the <a class="el" href="model_vocab.html">vocab</a> section for details.</p>
<p>In connLM, the vocabulary is learned from a text source(usually this would be the training corpus or a subset of it).</p>
<p>Since we will need the word counts information to build the output layer of connLM model, the learning process is mandatory. If you want to limit the words in vocabulary in a pre-defined list, you can pre-process the learning text to map the words outside your list to <code>&lt;unk&gt;</code>.</p>
<p>The <code>connlm-vocab</code> should be used for learning vocabulary, the wrapper script is <code></code>../steps/learn_vocab.sh,</p>
<div class="fragment"><div class="line">$ ../steps/learn_vocab.sh</div><div class="line">../steps/learn_vocab.sh</div><div class="line">usage: ../steps/learn_vocab.sh &lt;train-file&gt; &lt;exp-dir&gt;</div><div class="line">e.g.: ../steps/learn_vocab.sh data/train exp</div><div class="line">options:</div><div class="line">     --config-file &lt;file&gt;         # vocab config file.</div></div><!-- fragment --><p>It will learn the vocabulary from <code>&lt;train-file&gt;</code> and placed the resulting model file to <code>&lt;exp-dir&gt;/vocab</code>.clm. Users can pass configurations to <code>connlm-vocab</code> through <code>--config-file</code> option, for details of the configurations, please see the <a class="el" href="cmd.html#cmd_vocab">command description</a>.</p>
<h2><a class="anchor" id="examples_standalone"></a>
Training Standalone Model</h2>
<p>Each step of the rest in <code>run.sh</code> will train a connLM model. There are two ways to train model in connLM. In a standalone setup, the structure of network is defined before training and fixed after initializing it, while in a cascaded setup, we extend the components of network one by one during training.</p>
<div class="fragment"><div class="line">$ ../steps/run_standalone.sh</div><div class="line">../steps/run_standalone.sh</div><div class="line">usage: ../steps/run_standalone.sh &lt;model-type&gt; &lt;conf-dir&gt; &lt;exp-dir&gt; &lt;train-file&gt; &lt;valid-file&gt; [test-file]</div><div class="line">e.g.: ../steps/run_standalone.sh rnn conf exp data/train data/valid data/test</div><div class="line">options:</div><div class="line">     --train-thr &lt;threads&gt;    # <span class="keywordflow">default</span>: 1.</div><div class="line">     --eval-thr &lt;threads&gt;     # <span class="keywordflow">default</span>: 1.</div><div class="line">     --stage &lt;stags&gt;          # <span class="keywordflow">default</span>: <span class="stringliteral">&quot;&quot;</span>.</div></div><!-- fragment --><p>This script will train a model with <code>&lt;train-file&gt;</code> and dump the final model in <code>&lt;exp-dir&gt;/&lt;model-type&gt;/final</code>.clm, and search directory <code>&lt;conf-dir&gt;/&lt;model-type&gt;</code> for configurations.</p>
<p>There are 3 stages in <code>run_standalone.sh</code>. First, it calls <code></code>../steps/init_model.sh to initialize the network structure and value of weights. Then, <code></code>../steps/train_model.sh is invoked to train the initialized model with training data. At last, if <code>&lt;test-file&gt;</code> is specified, it runs <code></code>../steps/eval_model.sh to compute and report the perplexity of test set.</p>
<h3><a class="anchor" id="Name"></a>
Convention for Configurations</h3>
<p>Generally, every command of connLM toolkit will have at least one configuration file for common setups, like logging. The name of the configuration file would be consistence with the name of command line tool. They includes:</p>
<ul>
<li><code>vocab.conf</code> to specify the options for <code>connlm-vocab</code> </li>
<li><code>output.conf</code> to specify the options for <code>connlm-output</code> </li>
<li><code>init.conf</code> to specify the options for <code>connlm-init</code> </li>
<li><code>train.conf</code> to specify the options for <code>connlm-train</code> </li>
<li><code>eval.conf</code> to specify the options for <code>connlm-eval</code> </li>
</ul>
<p>Besides, there is another configuration for defining network topology. It would be called <code>topo</code>, placed under the configuration directory of one model. The format of this file is described in <a class="el" href="model_network_topo.html">this page</a>.</p>
<h2><a class="anchor" id="examples_cascade"></a>
Training Cascade Model</h2>
<p>Since a connLM model could consist of multiply components, we can merge sub-parts of network into a new one, as long as their output layer is the same.</p>
<p>With this property, one can train a model gradually. We support this type of training with <code></code>../steps/run_cascade.sh, whose usage is similar with <code></code>../steps/run_standalone.sh except that the <code>&lt;model-type&gt;</code> must contain at least one '~' character.</p>
<p>Every word separated by '~' is the name of one component, the <code>init.conf</code> and <code>topo</code> for this component should be placed in the sub-directory under <code>&lt;conf-dir&gt;/&lt;model-type&gt;</code> with the same name.</p>
<p>The workflow of training cascade model becomes:</p>
<pre class="fragment">model = {}
for comp in components
  1. initialize comp
  2. merge comp into model
  3. train with model
</pre><p>The order of components is given by the model name from left to right. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">connLM</a></li>
    <li class="footer">Generated on Tue May 9 2017 14:46:15 for connLM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
